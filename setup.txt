apt-get update
apt-get install -y build-essential python3-dev python3-setuptools make cmake
apt-get install -y ffmpeg libavcodec-dev libavfilter-dev libavformat-dev libavutil-dev
apt-get install -y cmake

# https://launchpad.net/ubuntu/+source/ffmpeg
apt-get install libavdevice-dev=7:4.4.2-0ubuntu0.22.04.1  # not included in PPA savory1

# make symbolic link
ln -s /lib/x86_64-linux-gnu/libnvcuvid.so.565.57.01  /usr/local/cuda/libnvcuvid.so

git clone --recursive https://github.com/dmlc/decord
cd decord
mkdir build && cd build
cmake .. -DUSE_CUDA=/usr/local/cuda -DCMAKE_BUILD_TYPE=Release
make
cd ../python
python setup.py install --user

cd /workspace/moment-retrieval-with-llm
pip install -r requirements.txt
pip install flash-attn==2.7.3 --no-build-isolation # after this version there's an error installing
